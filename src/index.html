<!doctype html>
<html ng-app="est">
  <head>
    <meta charset="utf-8">
    <title>est</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- build:css({.tmp/serve,src}) styles/vendor.css -->
    <!-- bower:css -->
    <!-- run `gulp inject` to automatically populate bower styles dependencies -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:css({.tmp/serve,src}) styles/app.css -->
    <!-- inject:css -->
    <!-- css files will be automatically insert here -->
    <!-- endinject -->
    <!-- endbuild -->

    <script>
        // Adapted slightly from Sam Dutton
        // Set name of hidden property and visibility change event
        // since some browsers only offer vendor-prefixed support
        // var hidden, state, visibilityChange; 
        // if (typeof document.hidden !== "undefined") {
        //     hidden = "hidden";
        //     visibilityChange = "visibilitychange";
        //     state = "visibilityState";
        // } else if (typeof document.mozHidden !== "undefined") {
        //     hidden = "mozHidden";
        //     visibilityChange = "mozvisibilitychange";
        //     state = "mozVisibilityState";
        // } else if (typeof document.msHidden !== "undefined") {
        //     hidden = "msHidden";
        //     visibilityChange = "msvisibilitychange";
        //     state = "msVisibilityState";
        // } else if (typeof document.webkitHidden !== "undefined") {
        //     hidden = "webkitHidden";
        //     visibilityChange = "webkitvisibilitychange";
        //     state = "webkitVisibilityState";
        // }

        // // Add a listener that constantly changes the title
        // document.addEventListener(visibilityChange, function() {
        //     document.title = document[state];
        //     console.log(document[state]);
        // }, false);

        // // Set the initial value
        // document.title = document[state];

    </script>
  </head>
  <body>
    <!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div id="test">Lorem ipsum.</div>
    <script>
        var doc = document;
        var _test = doc.getElementById('test');



        // (function() {
        //   var proxied = window.alert;
        //   window.alert = function() {
        //     // do something here
        //     return proxied.apply(this, arguments);
        //   };
        // })();
        // function listener() {
        //     var now = new Date().valueOf();
        //     setTimeout(function () {
        //         if (new Date().valueOf() - now > 100) return;
        //         console.log('no');
        //         window.location = "https://itunes.apple.com/us/app/flipagram/id512727332?mt=8";
        //     }, 25);
        //     try{
        //         window.location = "yiyi://";
        //         // window.open("yiyi://", '_blank');
        //     }catch(e){
        //         console.log(e);
        //     };
        //     // window.location = "twitter://post?message=";
        // }
        
        // _test.addEventListener('click' , listener);
        

        var redirect = function (location) {
            var iframe = document.createElement('iframe');
            iframe.setAttribute('src', location);
            iframe.setAttribute('target', '_blank');
            iframe.setAttribute('width', '1px');
            iframe.setAttribute('height', '1px');
            iframe.setAttribute('position', 'absolute');
            iframe.setAttribute('top', '0');
            iframe.setAttribute('left', '0');
            document.documentElement.appendChild(iframe);
            iframe.parentNode.removeChild(iframe);
            iframe = null;
        };

        var hidden, state, visibilityChange; 
        if (typeof document.hidden !== "undefined") {
            hidden = "hidden";
            visibilityChange = "visibilitychange";
            state = "visibilityState";
        } else if (typeof document.mozHidden !== "undefined") {
            hidden = "mozHidden";
            visibilityChange = "mozvisibilitychange";
            state = "mozVisibilityState";
        } else if (typeof document.msHidden !== "undefined") {
            hidden = "msHidden";
            visibilityChange = "msvisibilitychange";
            state = "msVisibilityState";
        } else if (typeof document.webkitHidden !== "undefined") {
            hidden = "webkitHidden";
            visibilityChange = "webkitvisibilitychange";
            state = "webkitVisibilityState";
        }

        // Add a listener that constantly changes the title
        // document.addEventListener(visibilityChange, function() {
        //     console.log(document[state]);
        // }, false);

        function checkVisibility() {
            if (document[state] == 'hidden') {
                return false;
            } else if(document[state] == 'visible') {
                return true;
            };
        }

        function lis() {
            var timerID;
            timerID = setTimeout(function () {
                if (checkVisibility()) {
                    window.confirm("sometext");
                    // window.location = "https://itunes.apple.com/us/app/flipagram/id512727332?mt=8";
                    // redirect('https://itunes.apple.com/us/app/flipagram/id512727332?mt=8');
                    console.log('no');
                };
                clearTimeout(timerID);                
            }, 25);

            redirect('yiyi://');
        }        

        _test.addEventListener('click' , lis);

        

    </script>
    <div ui-view></div>
    <div class="icon-sprite mail-icon"></div>

    <!-- build:js(src) scripts/vendor.js -->
    <!-- bower:js -->
    <!-- run `gulp inject` to automatically populate bower script dependencies -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:js({.tmp/serve,.tmp/partials,src}) scripts/app.js -->
    <!-- inject:js -->
    <!-- js files will be automatically insert here -->
    <!-- endinject -->

    <!-- inject:partials -->
    <!-- angular templates will be automatically converted in js and inserted here -->
    <!-- endinject -->
    <!-- endbuild -->

  </body>
</html>
